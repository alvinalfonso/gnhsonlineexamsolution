<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FocusExam Platform</title>
    
    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- 3. Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 4. Firebase SDKs (Compat) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f8fafc; }
        .animate-fade-in { animation: fadeIn 0.3s ease-in; }
        .animate-pulse-slow { animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- ICONS ---
        const Icon = ({ size = 24, color = "currentColor", children, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>{children}</svg>
        );
        const ShieldAlert = (props) => <Icon {...props}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10" /><path d="M12 8v4" /><path d="M12 16h.01" /></Icon>;
        const List = (props) => <Icon {...props}><line x1="8" x2="21" y1="6" y2="6" /><line x1="8" x2="21" y1="12" y2="12" /><line x1="8" x2="21" y1="18" y2="18" /><line x1="3" x2="3.01" y1="6" y2="6" /><line x1="3" x2="3.01" y1="12" y2="12" /><line x1="3" x2="3.01" y1="18" y2="18" /></Icon>;
        const FileText = (props) => <Icon {...props}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" /><polyline points="14 2 14 8 20 8" /><line x1="16" x2="8" y1="13" y2="13" /><line x1="16" x2="8" y1="17" y2="17" /><line x1="10" x2="8" y1="9" y2="9" /></Icon>;
        const Hash = (props) => <Icon {...props}><line x1="4" x2="20" y1="9" y2="9" /><line x1="4" x2="20" y1="15" y2="15" /><line x1="10" x2="8" y1="3" y2="21" /><line x1="16" x2="14" y1="3" y2="21" /></Icon>;
        const Type = (props) => <Icon {...props}><polyline points="4 7 4 4 20 4 20 7" /><line x1="9" x2="15" y1="20" y2="20" /><line x1="12" x2="12" y1="4" y2="20" /></Icon>;
        const PlusCircle = (props) => <Icon {...props}><circle cx="12" cy="12" r="10" /><path d="M8 12h8" /><path d="M12 8v8" /></Icon>;
        const Trash2 = (props) => <Icon {...props}><path d="M3 6h18" /><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" /><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" /><line x1="10" x2="10" y1="11" y2="17" /><line x1="14" x2="14" y1="11" y2="17" /></Icon>;
        const Play = (props) => <Icon {...props}><polygon points="5 3 19 12 5 21 5 3" /></Icon>;
        const Download = (props) => <Icon {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="7 10 12 15 17 10" /><line x1="12" x2="12" y1="15" y2="3" /></Icon>;
        const AlertCircle = (props) => <Icon {...props}><circle cx="12" cy="12" r="10" /><line x1="12" x2="12" y1="8" y2="12" /><line x1="12" x2="12.01" y1="16" y2="16" /></Icon>;
        const CheckCircle = (props) => <Icon {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" /><polyline points="22 4 12 14.01 9 11.01" /></Icon>;
        const AlertTriangle = (props) => <Icon {...props}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" /><path d="M12 9v4" /><path d="M12 17h.01" /></Icon>;
        const LogIn = (props) => <Icon {...props}><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4" /><polyline points="10 17 15 12 10 7" /><line x1="15" x2="3" y1="12" y2="12" /></Icon>;
        const Database = (props) => <Icon {...props}><ellipse cx="12" cy="5" rx="9" ry="3" /><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3" /><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5" /></Icon>;
        const X = (props) => <Icon {...props}><path d="M18 6 6 18" /><path d="m6 6 12 12" /></Icon>;
        const Code = (props) => <Icon {...props}><polyline points="16 18 22 12 16 6" /><polyline points="8 6 2 12 8 18" /></Icon>;
        const User = (props) => <Icon {...props}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></Icon>;
        const CloudUpload = (props) => <Icon {...props}><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242" /><path d="M12 12v9" /><path d="m16 16-4-4-4 4" /></Icon>;
        const Radio = (props) => <Icon {...props}><path d="M4.9 19.1C1 15.2 1 8.8 4.9 4.9" /><path d="M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5" /><circle cx="12" cy="12" r="2" /><path d="M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5" /><path d="M19.1 4.9C23 8.8 23 15.1 19.1 19" /></Icon>;
        const GraduationCap = (props) => <Icon {...props}><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></Icon>;

        // --- FIREBASE CONFIGURATION ---
        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyCrpCFcwF9TtVMOzi2zNJYv-IVYKENC_i4",
            authDomain: "gnhs-online-exam-solution.firebaseapp.com",
            databaseURL: "https://gnhs-online-exam-solution-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "gnhs-online-exam-solution",
            storageBucket: "gnhs-online-exam-solution.firebasestorage.app",
            messagingSenderId: "582595227570",
            appId: "1:582595227570:web:b912bc8c007248a085feab",
            measurementId: "G-RSTERRCZ19"
        };

        // --- AUTHORIZED ADMIN EMAILS ---
        const AUTHORIZED_TEACHERS = [
            "alvin.alfonso1262@gmail.com",
            "alvin.alfonso2222@gmail.com",
            "alvina.rhss@gmail.com"
        ];

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(FIREBASE_CONFIG);
        }
        const auth = firebase.auth();
        const db = firebase.database();

        // --- COMPONENTS ---

        // 1. LANDING PAGE
        const LandingPage = ({ onSelectRole }) => {
            return (
                <div className="min-h-screen bg-slate-50 flex items-center justify-center p-4">
                    <div className="max-w-4xl w-full bg-white rounded-2xl shadow-xl overflow-hidden flex flex-col md:flex-row">
                        {/* Left Side: Branding */}
                        <div className="bg-slate-900 p-10 flex flex-col justify-center text-white md:w-5/12">
                            <div className="mb-6"><ShieldAlert size={64} className="text-indigo-400"/></div>
                            <h1 className="text-4xl font-bold mb-4">FocusExam</h1>
                            <p className="text-slate-300 text-lg leading-relaxed">
                                A secure, integrity-focused testing platform for modern education.
                            </p>
                        </div>
                        
                        {/* Right Side: Role Selection */}
                        <div className="p-10 flex flex-col justify-center md:w-7/12">
                            <h2 className="text-2xl font-bold text-slate-800 mb-8 text-center">Select Your Role</h2>
                            
                            <div className="space-y-4">
                                <button 
                                    onClick={() => onSelectRole('teacher')}
                                    className="w-full flex items-center p-4 border-2 border-slate-200 rounded-xl hover:border-indigo-600 hover:bg-indigo-50 transition-all group text-left"
                                >
                                    <div className="bg-indigo-100 p-3 rounded-full mr-4 group-hover:bg-indigo-600 group-hover:text-white transition-colors">
                                        <LogIn size={24}/>
                                    </div>
                                    <div>
                                        <h3 className="font-bold text-lg text-slate-800">I am a Teacher</h3>
                                        <p className="text-slate-500 text-sm">Create, assign, and grade exams</p>
                                    </div>
                                </button>

                                <button 
                                    onClick={() => onSelectRole('student')}
                                    className="w-full flex items-center p-4 border-2 border-slate-200 rounded-xl hover:border-green-600 hover:bg-green-50 transition-all group text-left"
                                >
                                    <div className="bg-green-100 p-3 rounded-full mr-4 group-hover:bg-green-600 group-hover:text-white transition-colors">
                                        <GraduationCap size={24}/>
                                    </div>
                                    <div>
                                        <h3 className="font-bold text-lg text-slate-800">I am a Student</h3>
                                        <p className="text-slate-500 text-sm">Take assigned exams</p>
                                    </div>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // 2. TEACHER LOGIN (Strict Check)
        const TeacherLogin = ({ onSuccess, onBack }) => {
            const handleGoogleLogin = () => {
                const provider = new firebase.auth.GoogleAuthProvider();
                auth.signInWithPopup(provider)
                    .then((result) => {
                        const email = result.user.email;
                        if (AUTHORIZED_TEACHERS.includes(email)) {
                            onSuccess(result.user);
                        } else {
                            // Unauthorized - Logout immediately
                            auth.signOut();
                            alert("â›” Access Denied: You are not authorized as a Teacher.\n\nPlease go back and sign in as a Student.");
                        }
                    })
                    .catch((error) => {
                        console.error(error);
                        alert("Login failed: " + error.message);
                    });
            };

            return (
                <div className="min-h-screen bg-slate-50 flex items-center justify-center">
                    <div className="bg-white p-8 rounded-xl shadow-lg max-w-md w-full text-center">
                        <div className="mx-auto bg-indigo-100 w-16 h-16 rounded-full flex items-center justify-center mb-4 text-indigo-600">
                            <ShieldAlert size={32} />
                        </div>
                        <h2 className="text-2xl font-bold text-slate-800 mb-2">Teacher Access</h2>
                        <p className="text-slate-500 mb-6">Restricted to authorized administrators only.</p>
                        
                        <button onClick={handleGoogleLogin} className="w-full bg-slate-900 text-white py-3 rounded-lg font-bold hover:bg-slate-800 flex items-center justify-center gap-2 mb-4">
                            <Icon size={20}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10" /></Icon> Sign in with Google
                        </button>
                        
                        <button onClick={onBack} className="text-slate-400 hover:text-slate-600 text-sm">Cancel</button>
                    </div>
                </div>
            );
        };

        // 3. STUDENT WAITING ROOM / EXAM
        const StudentPortal = ({ onBack }) => {
            const [activeExam, setActiveExam] = useState(null);
            const [studentName, setStudentName] = useState("");
            const [examStatus, setExamStatus] = useState("checking"); // checking, waiting, taking, submitted
            const [answers, setAnswers] = useState({});
            const [cheatCount, setCheatCount] = useState(0);
            
            // Listener for Active Exam
            useEffect(() => {
                const examRef = db.ref('active_exam');
                examRef.on('value', (snapshot) => {
                    const val = snapshot.val();
                    if (val) {
                        setActiveExam(val);
                        if (examStatus === 'checking' || examStatus === 'waiting') {
                            // Don't auto-start if already taking, but update data if needed? 
                            // Usually safer to just set available.
                        }
                    } else {
                        setActiveExam(null);
                    }
                    if(examStatus === 'checking') setExamStatus('waiting');
                });
                return () => examRef.off();
            }, [examStatus]);

            // Cheat Detection
            useEffect(() => {
                if (examStatus !== 'taking') return;
                
                const handleVisibility = () => {
                    if (document.hidden) {
                        setCheatCount(c => c + 1);
                        alert("WARNING: You left the exam tab! This has been recorded.");
                    }
                };
                document.addEventListener("visibilitychange", handleVisibility);
                return () => document.removeEventListener("visibilitychange", handleVisibility);
            }, [examStatus]);

            const startExam = () => {
                if (!studentName.trim()) return alert("Enter your name first.");
                setExamStatus("taking");
            };

            const submitExam = () => {
                if (!confirm("Submit answers?")) return;
                
                const submission = {
                    studentName,
                    examTitle: activeExam.title,
                    answers,
                    cheatStats: { count: cheatCount },
                    submittedAt: new Date().toISOString()
                };
                
                db.ref('submissions').push(submission).then(() => {
                    setExamStatus("submitted");
                });
            };

            if (examStatus === "submitted") {
                return (
                    <div className="min-h-screen bg-slate-50 flex items-center justify-center p-4 text-center">
                        <div className="bg-white p-10 rounded-2xl shadow-xl">
                            <div className="text-green-500 mb-4 mx-auto w-16 h-16"><CheckCircle size={64}/></div>
                            <h1 className="text-3xl font-bold text-slate-800 mb-2">Submitted!</h1>
                            <p className="text-slate-600">You may close this tab.</p>
                            <button onClick={() => window.location.reload()} className="mt-6 text-indigo-600 hover:underline">Back to Home</button>
                        </div>
                    </div>
                );
            }

            if (examStatus === "taking" && activeExam) {
                return (
                    <div className="min-h-screen bg-slate-50 p-6">
                        <div className="max-w-3xl mx-auto">
                            <div className="bg-white p-4 rounded-xl shadow-sm border border-indigo-100 mb-6 flex justify-between items-center sticky top-0 z-10">
                                <div>
                                    <h1 className="font-bold text-lg text-slate-800">{activeExam.title}</h1>
                                    <p className="text-xs text-slate-500">Student: {studentName}</p>
                                </div>
                                <div className={`px-3 py-1 rounded text-xs font-bold ${cheatCount > 0 ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}`}>
                                    {cheatCount > 0 ? "Flagged" : "Secure"}
                                </div>
                            </div>

                            <div className="space-y-6">
                                {activeExam.questions.map((q, i) => (
                                    <div key={i} className="bg-white p-6 rounded-xl shadow-sm">
                                        <p className="font-medium text-lg mb-4">{i+1}. {q.text}</p>
                                        {q.type === 'multiple_choice' ? (
                                            <div className="space-y-2">
                                                {q.options.map((opt, idx) => (
                                                    <label key={idx} className="flex items-center gap-3 p-3 border rounded-lg hover:bg-slate-50 cursor-pointer">
                                                        <input type="radio" name={`q${i}`} onChange={() => setAnswers({...answers, [q.id]: opt})} />
                                                        <span>{opt}</span>
                                                    </label>
                                                ))}
                                            </div>
                                        ) : (
                                            <textarea className="w-full border p-3 rounded h-24" placeholder="Answer..." onChange={(e) => setAnswers({...answers, [q.id]: e.target.value})}></textarea>
                                        )}
                                    </div>
                                ))}
                                <button onClick={submitExam} className="w-full bg-indigo-600 text-white py-4 rounded-xl font-bold hover:bg-indigo-700 shadow-lg">Submit Final Answers</button>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-slate-50 flex items-center justify-center p-4">
                    <div className="max-w-md w-full bg-white rounded-2xl shadow-xl p-8 text-center">
                        <button onClick={onBack} className="absolute top-4 left-4 text-slate-400 hover:text-slate-600"><Icon size={24}><path d="m15 18-6-6 6-6"/></Icon></button>
                        
                        <div className="mb-6 mx-auto bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center text-blue-600">
                            <Radio size={32} />
                        </div>
                        
                        <h2 className="text-2xl font-bold text-slate-800 mb-2">Student Portal</h2>
                        
                        {!activeExam ? (
                            <div className="my-8 py-8 bg-slate-50 rounded-xl border border-dashed border-slate-300">
                                <p className="text-slate-500 animate-pulse">Waiting for teacher to assign exam...</p>
                                <p className="text-xs text-slate-400 mt-2">Do not refresh. It will appear automatically.</p>
                            </div>
                        ) : (
                            <div className="my-6 text-left">
                                <div className="bg-green-50 border border-green-200 p-4 rounded-lg mb-4">
                                    <p className="text-green-800 font-bold flex items-center gap-2"><CheckCircle size={16}/> Exam Assigned!</p>
                                    <p className="text-green-700">{activeExam.title}</p>
                                    <p className="text-xs text-green-600 mt-1">{activeExam.questions.length} Questions</p>
                                </div>
                                <label className="block text-sm font-bold text-slate-700 mb-2">Enter Your Name to Begin</label>
                                <input 
                                    className="w-full p-3 border border-slate-300 rounded-lg mb-4"
                                    placeholder="Full Name"
                                    value={studentName}
                                    onChange={e => setStudentName(e.target.value)}
                                />
                                <button onClick={startExam} className="w-full bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700">Start Exam</button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // 4. TEACHER DASHBOARD (Main)
        const TeacherDashboard = ({ user, onLogout }) => {
            const [questions, setQuestions] = useState([]);
            const [examTitle, setExamTitle] = useState("Midterm Examination");
            const [activeType, setActiveType] = useState("multiple_choice");
            const [view, setView] = useState("builder");
            const [currentQ, setCurrentQ] = useState({ text: "", options: ["","","",""] });
            const [isPublished, setIsPublished] = useState(false);

            useEffect(() => {
                // Check if an exam is currently active
                db.ref('active_exam').on('value', s => setIsPublished(!!s.val()));
            }, []);

            const publishExam = () => {
                if (questions.length === 0) return alert("Add questions first.");
                if (confirm("Publish this exam to all connected students?")) {
                    db.ref('active_exam').set({
                        title: examTitle,
                        questions: questions,
                        createdAt: new Date().toISOString()
                    });
                    alert("Exam Published! Students can now see it.");
                }
            };

            const closeExam = () => {
                if (confirm("Stop the exam? Students will no longer be able to start.")) {
                    db.ref('active_exam').remove();
                    alert("Exam Closed.");
                }
            };

            const addQuestion = () => {
                if(!currentQ.text) return;
                setQuestions([...questions, { ...currentQ, id: Date.now(), type: activeType }]);
                setCurrentQ({ text: "", options: ["","","",""] });
            };

            if (view === "results") return (
                // Results Component Inline for brevity since we're in one file
                <div className="max-w-5xl mx-auto p-6">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-2xl font-bold">Results</h2>
                        <button onClick={() => setView("builder")} className="text-slate-500">Back</button>
                    </div>
                    <ResultsList />
                </div>
            );

            return (
                <div className="max-w-6xl mx-auto p-4 md:p-6 animate-fade-in text-slate-800">
                    <header className="mb-8 flex justify-between items-center bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                        <div>
                            <h1 className="text-2xl font-bold flex items-center gap-2">
                                <ShieldAlert className="text-indigo-600" /> FocusExam
                            </h1>
                            <p className="text-xs text-green-600 font-bold bg-green-50 px-2 py-1 rounded inline-block mt-1">Admin Access: {user.email}</p>
                        </div>
                        <div className="flex gap-2">
                            {/* EXAM CONTROLS */}
                            {isPublished ? (
                                <button onClick={closeExam} className="bg-red-100 text-red-700 px-4 py-2 rounded-lg font-bold hover:bg-red-200 flex items-center gap-2 border border-red-200 animate-pulse">
                                    <X size={18}/> Close Exam
                                </button>
                            ) : (
                                <button onClick={publishExam} className="bg-green-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-green-700 flex items-center gap-2 shadow-lg shadow-green-200">
                                    <CloudUpload size={18}/> Publish to Students
                                </button>
                            )}
                            
                            <div className="h-10 w-px bg-slate-200 mx-2"></div>

                            <button onClick={() => setView("results")} className="bg-white border border-slate-300 text-slate-700 px-4 py-2 rounded-lg font-bold hover:bg-slate-50 flex items-center gap-2">
                                <Database size={18}/> Results
                            </button>
                            <button onClick={onLogout} className="text-slate-400 hover:text-red-500 p-2"><LogOut size={20}/></button>
                        </div>
                    </header>

                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        {/* Builder Left */}
                        <div className="lg:col-span-1 space-y-6">
                            <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                                <input className="w-full p-2 border rounded font-bold text-lg mb-4" value={examTitle} onChange={e => setExamTitle(e.target.value)} />
                                <div className="flex gap-2 mb-4 bg-slate-100 p-1 rounded">
                                    {['multiple_choice', 'essay'].map(t => (
                                        <button key={t} onClick={() => setActiveType(t)} className={`flex-1 py-1 text-xs font-bold uppercase rounded ${activeType === t ? 'bg-white shadow' : 'text-slate-500'}`}>{t.replace('_', ' ')}</button>
                                    ))}
                                </div>
                                <textarea className="w-full p-3 border rounded-lg h-24 mb-3 text-sm" placeholder="Question..." value={currentQ.text} onChange={e => setCurrentQ({...currentQ, text: e.target.value})}></textarea>
                                {activeType === 'multiple_choice' && currentQ.options.map((opt, i) => (
                                    <input key={i} className="w-full p-2 border rounded text-sm mb-2" placeholder={`Option ${i+1}`} value={opt} onChange={e => { const n = [...currentQ.options]; n[i] = e.target.value; setCurrentQ({...currentQ, options: n}); }}/>
                                ))}
                                <button onClick={addQuestion} className="w-full bg-slate-800 text-white py-2 rounded font-bold hover:bg-slate-900 mt-2">Add Question</button>
                            </div>
                        </div>

                        {/* Builder Right (Preview) */}
                        <div className="lg:col-span-2">
                            <div className="bg-white rounded-xl shadow-sm border border-slate-200 p-6 min-h-[500px]">
                                <h3 className="font-bold border-b pb-2 mb-4 text-slate-500">Live Preview</h3>
                                {questions.map((q, i) => (
                                    <div key={q.id} className="p-4 border rounded-lg mb-3 relative group">
                                        <button onClick={() => setQuestions(questions.filter(x => x.id !== q.id))} className="absolute top-2 right-2 text-red-300 hover:text-red-500"><Trash2 size={16}/></button>
                                        <p className="font-bold mb-2">{i+1}. {q.text}</p>
                                        {q.type === 'multiple_choice' && <div className="space-y-1 pl-4 border-l-2">{q.options.map((o, idx) => <div key={idx} className="text-sm text-slate-600">{String.fromCharCode(65+idx)}. {o}</div>)}</div>}
                                    </div>
                                ))}
                                {questions.length === 0 && <p className="text-slate-400 text-center mt-20">Start adding questions on the left.</p>}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Results Sub-component
        const ResultsList = () => {
            const [subs, setSubs] = useState([]);
            useEffect(() => {
                db.ref('submissions').on('value', s => {
                    if(s.val()) setSubs(Object.values(s.val()));
                });
            }, []);
            return (
                <div className="bg-white rounded shadow overflow-hidden">
                    <table className="w-full text-left text-sm">
                        <thead className="bg-slate-100"><tr><th className="p-3">Student</th><th className="p-3">Score/Integrity</th><th className="p-3">Time</th></tr></thead>
                        <tbody>
                            {subs.map((s, i) => (
                                <tr key={i} className="border-t hover:bg-slate-50">
                                    <td className="p-3 font-medium">{s.studentName}</td>
                                    <td className="p-3"><span className={`px-2 py-1 rounded text-xs ${s.cheatStats?.count > 0 ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}`}>{s.cheatStats?.count || 0} Flags</span></td>
                                    <td className="p-3 text-slate-500">{new Date(s.submittedAt).toLocaleTimeString()}</td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            );
        };

        // --- APP CONTROLLER ---
        const App = () => {
            const [page, setPage] = useState('landing'); // landing, teacher-login, student-portal, teacher-dashboard
            const [user, setUser] = useState(null);

            const handleTeacherSuccess = (u) => {
                setUser(u);
                setPage('teacher-dashboard');
            };

            const handleLogout = () => {
                auth.signOut();
                setUser(null);
                setPage('landing');
            };

            return (
                <div className="bg-slate-50 min-h-screen">
                    {page === 'landing' && <LandingPage onSelectRole={(role) => setPage(role === 'teacher' ? 'teacher-login' : 'student-portal')} />}
                    
                    {page === 'teacher-login' && <TeacherLogin onSuccess={handleTeacherSuccess} onBack={() => setPage('landing')} />}
                    
                    {page === 'student-portal' && <StudentPortal onBack={() => setPage('landing')} />}
                    
                    {page === 'teacher-dashboard' && user && <TeacherDashboard user={user} onLogout={handleLogout} />}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
