<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FocusExam Teacher Dashboard</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f8fafc; }
        .animate-fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- ICONS ---
        const Icon = ({ size = 24, color = "currentColor", children, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>{children}</svg>
        );
        const ShieldAlert = (p) => <Icon {...p}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10" /><path d="M12 8v4" /><path d="M12 16h.01" /></Icon>;
        const List = (p) => <Icon {...p}><line x1="8" x2="21" y1="6" y2="6" /><line x1="8" x2="21" y1="12" y2="12" /><line x1="8" x2="21" y1="18" y2="18" /><line x1="3" x2="3.01" y1="6" y2="6" /><line x1="3" x2="3.01" y1="12" y2="12" /><line x1="3" x2="3.01" y1="18" y2="18" /></Icon>;
        const FileText = (p) => <Icon {...p}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" /><polyline points="14 2 14 8 20 8" /></Icon>;
        const Hash = (p) => <Icon {...p}><line x1="4" x2="20" y1="9" y2="9" /><line x1="4" x2="20" y1="15" y2="15" /><line x1="10" x2="8" y1="3" y2="21" /><line x1="16" x2="14" y1="3" y2="21" /></Icon>;
        const Type = (p) => <Icon {...p}><polyline points="4 7 4 4 20 4 20 7" /><line x1="9" x2="15" y1="20" y2="20" /><line x1="12" x2="12" y1="4" y2="20" /></Icon>;
        const PlusCircle = (p) => <Icon {...p}><circle cx="12" cy="12" r="10" /><path d="M8 12h8" /><path d="M12 8v8" /></Icon>;
        const Trash2 = (p) => <Icon {...p}><path d="M3 6h18" /><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" /><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" /></Icon>;
        const Play = (p) => <Icon {...p}><polygon points="5 3 19 12 5 21 5 3" /></Icon>;
        const Download = (p) => <Icon {...p}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="7 10 12 15 17 10" /><line x1="12" x2="12" y1="15" y2="3" /></Icon>;
        const AlertCircle = (p) => <Icon {...p}><circle cx="12" cy="12" r="10" /><line x1="12" x2="12" y1="8" y2="12" /><line x1="12" x2="12.01" y1="16" y2="16" /></Icon>;
        const CheckCircle = (p) => <Icon {...p}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" /><polyline points="22 4 12 14.01 9 11.01" /></Icon>;
        const AlertTriangle = (p) => <Icon {...p}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" /><path d="M12 9v4" /><path d="M12 17h.01" /></Icon>;
        const LogIn = (p) => <Icon {...p}><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4" /><polyline points="10 17 15 12 10 7" /><line x1="15" x2="3" y1="12" y2="12" /></Icon>;
        const Database = (p) => <Icon {...p}><ellipse cx="12" cy="5" rx="9" ry="3" /><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3" /><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5" /></Icon>;
        const X = (p) => <Icon {...p}><path d="M18 6 6 18" /><path d="m6 6 12 12" /></Icon>;
        const Code = (p) => <Icon {...p}><polyline points="16 18 22 12 16 6" /><polyline points="8 6 2 12 8 18" /></Icon>;
        const LogOut = (p) => <Icon {...p}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" /><polyline points="16 17 21 12 16 7" /><line x1="21" x2="9" y1="12" y2="12" /></Icon>;
        const CloudUpload = (p) => <Icon {...p}><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242" /><path d="M12 12v9" /><path d="m16 16-4-4-4 4" /></Icon>;
        const GraduationCap = (p) => <Icon {...p}><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></Icon>;
        const Radio = (p) => <Icon {...p}><path d="M4.9 19.1C1 15.2 1 8.8 4.9 4.9" /><path d="M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5" /><circle cx="12" cy="12" r="2" /></Icon>;

        // --- CONFIG ---
        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyCrpCFcwF9TtVMOzi2zNJYv-IVYKENC_i4",
            authDomain: "gnhs-online-exam-solution.firebaseapp.com",
            databaseURL: "https://gnhs-online-exam-solution-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "gnhs-online-exam-solution",
            storageBucket: "gnhs-online-exam-solution.firebasestorage.app",
            messagingSenderId: "582595227570",
            appId: "1:582595227570:web:b912bc8c007248a085feab",
            measurementId: "G-RSTERRCZ19"
        };

        const AUTHORIZED_TEACHERS = [
            "alvin.alfonso1262@gmail.com",
            "alvin.alfonso2222@gmail.com",
            "alvina.rhss@gmail.com"
        ];

        // Init Firebase
        if (!firebase.apps.length) firebase.initializeApp(FIREBASE_CONFIG);
        const auth = firebase.auth();
        const db = firebase.database();

        // --- COMPONENTS ---

        // 1. RESULTS LIST
        const ResultsList = ({ onClose }) => {
            const [submissions, setSubmissions] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);

            useEffect(() => {
                const subRef = db.ref('submissions');
                const listener = subRef.on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        const subList = Object.entries(data).map(([key, val]) => ({ id: key, ...val }));
                        subList.sort((a,b) => new Date(b.submittedAt) - new Date(a.submittedAt));
                        setSubmissions(subList);
                    } else {
                        setSubmissions([]);
                    }
                    setLoading(false);
                }, (err) => {
                    console.error("Firebase Read Error:", err);
                    setError("Permission Denied or Network Error.");
                    setLoading(false);
                });
                return () => subRef.off('value', listener);
            }, []);

            return (
                <div className="max-w-5xl mx-auto p-6">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-2xl font-bold flex items-center gap-2"><Database/> Results</h2>
                        <button onClick={onClose} className="text-slate-500 hover:text-slate-800">Close</button>
                    </div>
                    {loading && <p>Loading...</p>}
                    {error && <p className="text-red-500">{error}</p>}
                    {!loading && !error && (
                        <div className="bg-white rounded shadow overflow-x-auto">
                            <table className="w-full text-left">
                                <thead className="bg-slate-100 border-b">
                                    <tr>
                                        <th className="p-3">Student</th>
                                        <th className="p-3">Exam</th>
                                        <th className="p-3">Integrity</th>
                                        <th className="p-3">Time</th>
                                        <th className="p-3">Data</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {submissions.map(sub => (
                                        <tr key={sub.id} className="border-b hover:bg-slate-50">
                                            <td className="p-3 font-medium">{sub.studentName}</td>
                                            <td className="p-3 text-sm">{sub.examTitle}</td>
                                            <td className="p-3">
                                                <span className={`px-2 py-1 rounded text-xs ${sub.cheatStats?.count > 0 ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}`}>
                                                    {sub.cheatStats?.count || 0} Flags
                                                </span>
                                            </td>
                                            <td className="p-3 text-sm">{new Date(sub.submittedAt).toLocaleTimeString()}</td>
                                            <td className="p-3">
                                                <button onClick={() => alert(JSON.stringify(sub.answers, null, 2))} className="text-blue-600 text-xs underline">Answers</button>
                                            </td>
                                        </tr>
                                    ))}
                                    {submissions.length === 0 && <tr><td colSpan="5" className="p-4 text-center text-gray-400">No results found.</td></tr>}
                                </tbody>
                            </table>
                        </div>
                    )}
                </div>
            );
        };

        // 2. DOWNLOAD HELPER
        const downloadHtmlFile = (examTitle, questions) => {
            const embeddedData = JSON.stringify(questions);
            const embeddedConfig = JSON.stringify(FIREBASE_CONFIG);
            const scriptEnd = "<\/script>"; 
            
            const htmlContent = `<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>${examTitle}</title>
<script src="https://cdn.tailwindcss.com">${scriptEnd}
<script src="https://unpkg.com/react@18/umd/react.development.js">${scriptEnd}
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js">${scriptEnd}
<script src="https://unpkg.com/@babel/standalone/babel.min.js">${scriptEnd}
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js">${scriptEnd}
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js">${scriptEnd}
<style>body{font-family:sans-serif;background:#f8fafc}.fade{animation:f .3s ease-in}@keyframes f{from{opacity:0}to{opacity:1}}</style>
</head><body><div id="root"></div><script type="text/babel">
const {useState,useEffect}=React;
const Icon=({size=24,color="currentColor",children,...p})=><svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}>{children}</svg>;
const AlertTriangle=(p)=><Icon {...p}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></Icon>;
const CheckCircle=(p)=><Icon {...p}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></Icon>;
const firebaseConfig=${embeddedConfig};
if(!firebase.apps.length)firebase.initializeApp(firebaseConfig);
const db=firebase.database();
const EXAM_DATA={title:"${examTitle}",questions:${embeddedData}};
const StudentExam=()=>{
const [n,setN]=useState("");const [ans,setAns]=useState({});const [cc,setCc]=useState(0);const [st,setSt]=useState("active");
useEffect(()=>{
 const h=()=>{if(document.hidden&&st==="active"){setCc(c=>c+1);alert("Warning: Focus Lost logged.")}};
 document.addEventListener("visibilitychange",h);return()=>document.removeEventListener("visibilitychange",h);
},[st]);
const sub=()=>{
 if(!n)return alert("Name required");if(!confirm("Submit?"))return;
 setSt("submitting");
 db.ref('submissions').push({studentName:n,answers:ans,cheatStats:{count:cc},submittedAt:new Date().toISOString(),examTitle:EXAM_DATA.title})
 .then(()=>setSt("submitted")).catch(e=>{alert(e.message);setSt("active")});
};
if(st==="submitted")return <div className="p-10 text-center"><div className="text-green-500 text-4xl mb-2">âœ“</div><h1 className="text-2xl font-bold">Submitted</h1><p>Thank you, {n}.</p></div>;
return(
 <div className="max-w-2xl mx-auto p-6 bg-white min-h-screen">
  <div className="mb-6 border-b pb-4"><h1 className="text-xl font-bold">{EXAM_DATA.title}</h1></div>
  <div className="mb-6"><label className="block text-sm font-bold mb-1">Your Name</label><input className="w-full p-2 border rounded" value={n} onChange={e=>setN(e.target.value)}/></div>
  {EXAM_DATA.questions.map((q,i)=>(
   <div key={q.id} className="mb-6 p-4 border rounded bg-slate-50">
    <p className="font-medium mb-3">{i+1}. {q.text}</p>
    {q.type==='multiple_choice'?q.options.map((o,x)=><label key={x} className="block mb-2"><input type="radio" name={'q'+q.id} onChange={()=>setAns({...ans,[q.id]:o})}/> {o}</label>)
    :<textarea className="w-full p-2 border rounded" onChange={e=>setAns({...ans,[q.id]:e.target.value})}/>}
   </div>
  ))}
  <button onClick={sub} disabled={st==='submitting'} className="w-full bg-blue-600 text-white p-3 rounded font-bold">{st==='submitting'?'Uploading...':'Submit Exam'}</button>
 </div>
)};
const root=ReactDOM.createRoot(document.getElementById('root'));root.render(<StudentExam/>);
${scriptEnd}</body></html>`;

            try {
                const blob = new Blob([htmlContent], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${examTitle.replace(/\s+/g, '_')}_Exam.html`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            } catch (e) {
                alert("Download failed.");
            }
        };

        // 3. TEACHER DASHBOARD
        const TeacherDashboard = ({ user, onLogout }) => {
            const [questions, setQuestions] = useState([]);
            const [examTitle, setExamTitle] = useState("Midterm Examination");
            const [activeType, setActiveType] = useState("multiple_choice");
            const [view, setView] = useState("builder");
            const [currentQ, setCurrentQ] = useState({ text: "", options: ["","","",""] });
            const [isPublished, setIsPublished] = useState(false);

            useEffect(() => {
                const checkRef = db.ref('active_exam');
                const listener = checkRef.on('value', s => setIsPublished(!!s.val()), err => console.log("Read error (expected if student):", err));
                return () => checkRef.off('value', listener);
            }, []);

            const publishExam = () => {
                if (questions.length === 0) return alert("Add questions first.");
                if (confirm("Publish this exam? Students will see it immediately.")) {
                    db.ref('active_exam').set({
                        title: examTitle,
                        questions: questions,
                        createdAt: new Date().toISOString()
                    }).catch(e => alert("Error: " + e.message));
                }
            };

            const closeExam = () => {
                if (confirm("Close exam?")) {
                    db.ref('active_exam').remove().catch(e => alert(e.message));
                }
            };

            const addQuestion = () => {
                if(!currentQ.text) return;
                setQuestions([...questions, { ...currentQ, id: Date.now(), type: activeType }]);
                setCurrentQ({ text: "", options: ["","","",""] });
            };

            if (view === "results") return <ResultsList onClose={() => setView("builder")} />;

            return (
                <div className="max-w-6xl mx-auto p-4 md:p-6 animate-fade-in text-slate-800">
                    <header className="mb-8 flex justify-between items-center bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                        <div>
                            <h1 className="text-2xl font-bold flex items-center gap-2"><ShieldAlert className="text-indigo-600" /> FocusExam</h1>
                            <p className="text-xs text-green-600 font-bold bg-green-50 px-2 py-1 rounded inline-block mt-1">Admin: {user.email}</p>
                        </div>
                        <div className="flex gap-2">
                            {isPublished ? (
                                <button onClick={closeExam} className="bg-red-100 text-red-700 px-4 py-2 rounded-lg font-bold flex items-center gap-2 border border-red-200"><X size={18}/> Close Exam</button>
                            ) : (
                                <button onClick={publishExam} className="bg-green-600 text-white px-4 py-2 rounded-lg font-bold flex items-center gap-2 shadow-lg hover:bg-green-700"><CloudUpload size={18}/> Publish</button>
                            )}
                            <div className="h-10 w-px bg-slate-200 mx-2"></div>
                            <button onClick={() => setView("results")} className="bg-white border border-slate-300 text-slate-700 px-4 py-2 rounded-lg font-bold hover:bg-slate-50 flex items-center gap-2"><Database size={18}/> Results</button>
                            <button onClick={() => downloadHtmlFile(examTitle, questions)} className="bg-indigo-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-indigo-700 flex items-center gap-2"><Download size={18}/> HTML</button>
                            <button onClick={onLogout} className="text-slate-400 hover:text-red-500 p-2"><Trash2 size={20}/></button>
                        </div>
                    </header>

                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div className="lg:col-span-1 space-y-6">
                            <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                                <input className="w-full p-2 border rounded font-bold text-lg mb-4" value={examTitle} onChange={e => setExamTitle(e.target.value)} />
                                <div className="flex gap-2 mb-4 bg-slate-100 p-1 rounded">
                                    {['multiple_choice', 'essay'].map(t => (
                                        <button key={t} onClick={() => setActiveType(t)} className={`flex-1 py-1 text-xs font-bold uppercase rounded ${activeType === t ? 'bg-white shadow' : 'text-slate-500'}`}>{t.replace('_', ' ')}</button>
                                    ))}
                                </div>
                                <textarea className="w-full p-3 border rounded-lg h-24 mb-3 text-sm" placeholder="Question..." value={currentQ.text} onChange={e => setCurrentQ({...currentQ, text: e.target.value})}></textarea>
                                {activeType === 'multiple_choice' && currentQ.options.map((opt, i) => (
                                    <input key={i} className="w-full p-2 border rounded text-sm mb-2" placeholder={`Option ${i+1}`} value={opt} onChange={e => { const n = [...currentQ.options]; n[i] = e.target.value; setCurrentQ({...currentQ, options: n}); }}/>
                                ))}
                                <button onClick={addQuestion} className="w-full bg-slate-800 text-white py-2 rounded font-bold hover:bg-slate-900 mt-2">Add Question</button>
                            </div>
                        </div>
                        <div className="lg:col-span-2">
                            <div className="bg-white rounded-xl shadow-sm border border-slate-200 p-6 min-h-[500px]">
                                <h3 className="font-bold border-b pb-2 mb-4 text-slate-500">Live Preview ({questions.length})</h3>
                                {questions.map((q, i) => (
                                    <div key={q.id} className="p-4 border rounded-lg mb-3 relative group">
                                        <button onClick={() => setQuestions(questions.filter(x => x.id !== q.id))} className="absolute top-2 right-2 text-red-300 hover:text-red-500">x</button>
                                        <p className="font-bold mb-2">{i+1}. {q.text}</p>
                                        {q.type === 'multiple_choice' && <div className="space-y-1 pl-4 border-l-2">{q.options.map((o, idx) => <div key={idx} className="text-sm text-slate-600">{String.fromCharCode(65+idx)}. {o}</div>)}</div>}
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // 4. STUDENT PORTAL
        const StudentPortal = ({ onBack }) => {
            const [activeExam, setActiveExam] = useState(null);
            const [studentName, setStudentName] = useState("");
            const [status, setStatus] = useState("waiting"); 
            const [answers, setAnswers] = useState({});
            const [cheatCount, setCheatCount] = useState(0);

            useEffect(() => {
                const examRef = db.ref('active_exam');
                const listener = examRef.on('value', (s) => {
                    const val = s.val();
                    if (val) { setActiveExam(val); if(status === 'waiting') setStatus("ready"); }
                    else { setActiveExam(null); setStatus("waiting"); }
                });
                return () => examRef.off('value', listener);
            }, [status]);

            // Cheat detection
            useEffect(() => {
                if (status !== 'taking') return;
                const h = () => { if (document.hidden) setCheatCount(c => c + 1); };
                document.addEventListener("visibilitychange", h);
                return () => document.removeEventListener("visibilitychange", h);
            }, [status]);

            const submit = () => {
                if (!confirm("Submit?")) return;
                db.ref('submissions').push({
                    studentName,
                    examTitle: activeExam.title,
                    answers,
                    cheatStats: { count: cheatCount },
                    submittedAt: new Date().toISOString()
                }).then(() => setStatus("submitted"));
            };

            if (status === "waiting") return (
                <div className="min-h-screen bg-slate-50 flex items-center justify-center p-4">
                    <div className="bg-white p-8 rounded-xl shadow text-center max-w-md w-full relative">
                        <button onClick={onBack} className="absolute top-4 left-4 text-gray-400">Back</button>
                        <h2 className="text-xl font-bold mb-4 text-slate-700">Student Portal</h2>
                        <div className="p-6 bg-yellow-50 text-yellow-700 rounded border border-yellow-200 animate-pulse">
                            Teacher has not assigned an exam yet.
                        </div>
                        <p className="text-xs text-gray-400 mt-4">Please wait here. Do not refresh.</p>
                    </div>
                </div>
            );

            if (status === "ready") return (
                <div className="min-h-screen bg-slate-50 flex items-center justify-center p-4">
                    <div className="bg-white p-8 rounded-xl shadow text-center max-w-md w-full">
                        <h2 className="text-xl font-bold mb-2 text-green-700">Exam Ready!</h2>
                        <p className="mb-4 text-slate-600">{activeExam.title}</p>
                        <input className="w-full p-3 border rounded mb-4" placeholder="Enter Full Name" value={studentName} onChange={e => setStudentName(e.target.value)} />
                        <button onClick={() => { if(studentName) setStatus("taking"); else alert("Name required"); }} className="w-full bg-green-600 text-white p-3 rounded font-bold">Start Exam</button>
                    </div>
                </div>
            );

            if (status === "taking") return (
                <div className="min-h-screen bg-slate-50 p-6">
                    <div className="max-w-3xl mx-auto">
                        <div className="bg-white p-4 rounded shadow mb-4 sticky top-0 z-10 flex justify-between">
                            <span className="font-bold">{activeExam.title}</span>
                            <span className={`text-xs px-2 py-1 rounded ${cheatCount > 0 ? 'bg-red-100 text-red-600' : 'bg-green-100 text-green-600'}`}>{cheatCount > 0 ? 'Flagged' : 'Secure'}</span>
                        </div>
                        {activeExam.questions.map((q, i) => (
                            <div key={i} className="bg-white p-6 rounded shadow mb-4">
                                <p className="font-bold mb-2">{i+1}. {q.text}</p>
                                {q.type === 'multiple_choice' ? q.options.map((o, x) => <label key={x} className="block mb-2"><input type="radio" name={'q'+i} onChange={()=>setAnswers({...answers, [q.id]:o})}/> {o}</label>) 
                                : <textarea className="w-full border p-2 rounded" onChange={e=>setAnswers({...answers, [q.id]:e.target.value})}/>}
                            </div>
                        ))}
                        <button onClick={submit} className="w-full bg-indigo-600 text-white p-4 rounded font-bold">Submit</button>
                    </div>
                </div>
            );

            return <div className="p-10 text-center"><h1>Submitted!</h1><button onClick={() => window.location.reload()}>Reset</button></div>;
        };

        // 5. LANDING PAGE
        const Landing = ({ onSelect }) => (
            <div className="min-h-screen bg-slate-50 flex items-center justify-center p-4">
                <div className="max-w-md w-full bg-white rounded-xl shadow-lg p-8 text-center">
                    <ShieldAlert size={48} className="mx-auto text-indigo-600 mb-4"/>
                    <h1 className="text-3xl font-bold text-slate-800 mb-8">FocusExam</h1>
                    <button onClick={() => onSelect('teacher')} className="w-full bg-slate-800 text-white p-4 rounded-lg font-bold mb-4 flex items-center justify-center gap-2 hover:bg-slate-900"><LogIn size={20}/> Teacher Login</button>
                    <button onClick={() => onSelect('student')} className="w-full border-2 border-slate-200 text-slate-700 p-4 rounded-lg font-bold flex items-center justify-center gap-2 hover:bg-slate-50"><GraduationCap size={20}/> Student Portal</button>
                </div>
            </div>
        );

        // 6. MAIN APP
        const App = () => {
            const [page, setPage] = useState('landing');
            const [user, setUser] = useState(null);

            const handleTeacherLogin = () => {
                const p = new firebase.auth.GoogleAuthProvider();
                auth.signInWithPopup(p).then(res => {
                    if (AUTHORIZED_TEACHERS.includes(res.user.email)) {
                        setUser(res.user);
                        setPage('teacher');
                    } else {
                        auth.signOut();
                        alert("Access Denied: You are not a registered teacher.");
                    }
                }).catch(e => alert(e.message));
            };

            if (page === 'landing') return <Landing onSelect={role => {
                if (role === 'teacher') handleTeacherLogin();
                else setPage('student');
            }} />;

            if (page === 'student') return <StudentPortal onBack={() => setPage('landing')} />;

            if (page === 'teacher' && user) return <TeacherDashboard user={user} onLogout={() => { auth.signOut(); setPage('landing'); }} />;

            return <div>Loading...</div>;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
